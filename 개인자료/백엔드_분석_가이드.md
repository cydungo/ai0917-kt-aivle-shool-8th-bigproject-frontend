# 백엔드 분석 가이드라인

이 문서는 `개인자료/backend_reference` 폴더에 있는 백엔드 코드를 분석하여 프론트엔드 개발에 필요한 핵심 사항을 정리한 것입니다. 백엔드 코드를 직접 수정하지 않고, API 요청 및 데이터 구조를 이해하는 데 활용하세요.

## 1. 사용자 모델 및 권한 (User.java)

### 데이터 구조

백엔드의 `User` 엔티티는 다음과 같은 필드를 가지고 있습니다. 프론트엔드에서 타입 정의 시 참고하세요.

| 필드명      | 타입          | 설명                                                  |
| ----------- | ------------- | ----------------------------------------------------- |
| `id`        | Long          | 사용자 고유 ID (DB PK)                                |
| `naverId`   | String        | 네이버 소셜 로그인 사용자 식별자 (일반 가입 시 null)  |
| `siteEmail` | String        | 사이트 자체 가입 이메일 ID (소셜 로그인 시 null 가능) |
| `role`      | Enum (String) | 사용자 권한 (`UserRole`)                              |
| `createdAt` | DateTime      | 가입 일시                                             |
| `updatedAt` | DateTime      | 정보 수정 일시                                        |

### 권한 (UserRole)

사용자 권한은 `UserRole` Enum으로 관리됩니다.

- `Author` (기본값): 일반 사용자/작가
- `Admin`: 관리자 (시스템 공지 관리 등)
- (추가 권한 확인 필요: 코드 상에서는 `Author`가 기본값으로 설정됨)

## 2. 보안 및 인증 (SecurityConfig.java)

### 인증 방식

- **HttpOnly Cookie**: JWT(JSON Web Token)를 `Authorization` 헤더가 아닌 **HttpOnly Cookie**에 담아 주고받습니다.
- **Stateless**: 세션을 서버 메모리에 저장하지 않고, JWT 토큰 자체로 인증을 수행합니다.

### CSRF 보호

- **CSRF Token**: `CookieCsrfTokenRepository`를 사용하여 CSRF 토큰을 쿠키로 발급합니다.
- 프론트엔드는 `POST`, `PUT`, `DELETE` 요청 시 `X-XSRF-TOKEN` 헤더에 쿠키 값을 포함해야 합니다 (Axios가 자동으로 처리하도록 설정됨).

### 공개 API (인증 불필요)

다음 경로는 로그인 없이 접근 가능합니다.

- `/api/v1/hello` (헬스 체크)
- `/api/v1/auth/naver/login` (네이버 로그인 시작)
- `/api/v1/auth/naver/callback` (네이버 로그인 콜백)

## 3. 네이버 로그인 흐름 (AuthController.java)

### 로그인 프로세스

1. **프론트엔드**: 사용자가 "네이버로 로그인" 버튼 클릭.
2. **백엔드 요청**: `/api/v1/auth/naver/login`으로 이동.
3. **리다이렉트**: 백엔드가 네이버 로그인 페이지 URL로 리다이렉트 (`response.sendRedirect`).
4. **사용자 인증**: 사용자가 네이버에서 로그인 및 정보 제공 동의.
5. **콜백**: 네이버가 인증 코드(code)와 상태(state)를 가지고 `/api/v1/auth/naver/callback`으로 리다이렉트.
6. **JWT 발급**: 백엔드가 네이버 API로 사용자 정보를 확인하고, 자체 JWT를 생성.
7. **프론트엔드 복귀**: 백엔드가 프론트엔드 콜백 URL로 리다이렉트하며, URL 파라미터나 쿠키로 토큰 상태를 전달 (코드 분석 상 `frontCallbackUrl + "?token=" + encoded` 형태로 리다이렉트).

### 주의사항

- 프론트엔드는 백엔드가 전달한 JWT를 받아 쿠키에 저장되어 있는지 확인하거나, URL 파라미터로 넘어온 토큰을 적절히 처리해야 합니다 (보안상 쿠키 세팅이 권장됨).
- 현재 백엔드 로직은 URL 파라미터로 토큰을 넘겨주는 방식이므로, 프론트엔드 콜백 페이지에서 이를 받아 처리하는 로직이 필요합니다.

## 4. 프론트엔드 개발 시 고려사항

- **API 요청**: 모든 API 요청은 `src/app/api/axios.ts`에 정의된 `apiClient`를 사용하세요. `withCredentials: true` 설정이 되어 있어 쿠키를 자동으로 포함합니다.
- **타입 정의**: `src/app/types/` 폴더에 백엔드 엔티티와 일치하는 타입을 정의하여 사용하세요.
- **에러 처리**: 백엔드 에러 응답 포맷을 확인하고, `interceptor`에서 일괄 처리하거나 `useQuery`의 `onError`에서 처리하세요.
